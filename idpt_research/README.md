# é©¬ä¸æ ¼å°”ç­–ç•¥ç ”ç©¶ (Martingale Strategy Research)

ç‹¬ç«‹ç ”ç©¶ç›®å½•ï¼Œç”¨äºæµ‹è¯•é©¬ä¸æ ¼å°”ç­–ç•¥åœ¨NQæœŸè´§ä¸Šçš„è¡¨ç°ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
idpt_research/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ martingale_strategy.py       # ç­–ç•¥å®ç°
â””â”€â”€ run_martingale.py           # ä¸»æ‰§è¡Œç¨‹åº
```

## ğŸ¯ ç­–ç•¥è¯´æ˜

### 1. æ ‡å‡†é©¬ä¸æ ¼å°” (Standard Martingale)
- **é€»è¾‘**: äºæŸæ—¶åŠ å€ä»“ä½ï¼Œæ‘Šä½æˆæœ¬
- **å‚æ•°**: 
  - åˆå§‹æ‰‹æ•°: 1
  - ç›ˆåˆ©ç›®æ ‡: 0.5%
  - äºæŸè§¦å‘: -0.3%
  - æœ€å¤§åŠ ä»“: 5æ¬¡
  - åŠ ä»“å€æ•°: 2.0
  - å…¨å±€æ­¢æŸ: -10%

### 2. ä¿å®ˆå‹é©¬ä¸æ ¼å°” (Conservative)
- æ›´å°çš„åŠ ä»“å€æ•° (1.5x)
- æ›´å°‘çš„åŠ ä»“æ¬¡æ•° (3æ¬¡)
- æ›´ç´§çš„æ­¢æŸ (-5%)

### 3. æ¿€è¿›å‹é©¬ä¸æ ¼å°” (Aggressive)
- æ›´å¤§çš„åŠ ä»“å€æ•° (2.5x)
- æ›´å¤šçš„åŠ ä»“æ¬¡æ•° (7æ¬¡)
- æ›´å®½çš„æ­¢æŸ (-15%)

### 4. åé©¬ä¸æ ¼å°” (Anti-Martingale)
- **é€»è¾‘**: ç›ˆåˆ©æ—¶åŠ ä»“ï¼Œæ­¢æŸåŠæ—¶
- é€‚åˆè¶‹åŠ¿è¡Œæƒ…

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€è¿è¡Œ
```bash
cd idpt_research
python run_martingale.py --start 2024-01-01 --end 2024-12-31
```

### æŒ‡å®šæ—¶é—´å‘¨æœŸ
```bash
# 1åˆ†é’Ÿçº§åˆ« (åŸå§‹M1æ•°æ®)
python run_martingale.py --timeframe m1 --start 2024-01-01 --end 2024-12-31

# 5åˆ†é’Ÿçº§åˆ«
python run_martingale.py --timeframe m5 --start 2024-01-01 --end 2024-12-31

# 15åˆ†é’Ÿçº§åˆ«
python run_martingale.py --timeframe m15 --start 2024-01-01 --end 2024-12-31

# 30åˆ†é’Ÿçº§åˆ«
python run_martingale.py --timeframe m30 --start 2024-01-01 --end 2024-12-31

# å°æ—¶çº§åˆ«
python run_martingale.py --timeframe h1 --start 2024-01-01 --end 2024-12-31

# 4å°æ—¶çº§åˆ«
python run_martingale.py --timeframe h4 --start 2024-01-01 --end 2024-12-31

# æ—¥çº¿çº§åˆ«
python run_martingale.py --timeframe d1 --start 2024-01-01 --end 2024-12-31

# å‘¨çº¿çº§åˆ«
python run_martingale.py --timeframe w1 --start 2024-01-01 --end 2024-12-31
```

### ä½¿ç”¨ä¸åŒç­–ç•¥
```bash
# ä¿å®ˆå‹
python run_martingale.py --strategy conservative --start 2024-01-01 --end 2024-12-31

# æ¿€è¿›å‹
python run_martingale.py --strategy aggressive --start 2024-01-01 --end 2024-12-31

# åé©¬ä¸æ ¼å°”
python run_martingale.py --strategy anti --start 2024-01-01 --end 2024-12-31
```

### å¯¹æ¯”æ‰€æœ‰ç­–ç•¥
```bash
python run_martingale.py --compare --start 2024-01-01 --end 2024-12-31
```

### è‡ªå®šä¹‰å‚æ•°
```bash
# è°ƒæ•´åˆå§‹èµ„é‡‘å’Œæ‰‹ç»­è´¹
python run_martingale.py --cash 200000 --commission 0.0003 --start 2024-01-01 --end 2024-12-31
```

## ğŸ“Š æ”¯æŒçš„æ—¶é—´å‘¨æœŸ

- `m1`: 1åˆ†é’Ÿ (M1åŸå§‹æ•°æ®)
- `m5`: 5åˆ†é’Ÿ
- `m10`: 10åˆ†é’Ÿ
- `m15`: 15åˆ†é’Ÿ
- `m30`: 30åˆ†é’Ÿ
- `h1`: 1å°æ—¶
- `h2`: 2å°æ—¶
- `h4`: 4å°æ—¶
- `d1`: æ—¥çº¿
- `w1`: å‘¨çº¿

**åŸç†**: ä½ çš„CSVæ˜¯M1çº§åˆ«æ•°æ®ï¼Œç¨‹åºä¼šè‡ªåŠ¨é‡é‡‡æ ·(resample)åˆ°æŒ‡å®šçš„æ—¶é—´å‘¨æœŸã€‚

## âš ï¸ é£é™©æç¤º

**é©¬ä¸æ ¼å°”ç­–ç•¥é£é™©æé«˜ï¼**

1. **çˆ†ä»“é£é™©**: è¿ç»­äºæŸä¼šå¯¼è‡´ä»“ä½æŒ‡æ•°çº§å¢é•¿
2. **èµ„é‡‘è¦æ±‚**: éœ€è¦å……è¶³çš„èµ„é‡‘æŠ—æ³¢åŠ¨
3. **å¸‚åœºé£é™©**: å‰§çƒˆå•è¾¹è¡Œæƒ…å¯èƒ½å¯¼è‡´å·¨é¢äºæŸ
4. **ä»…ä¾›ç ”ç©¶**: æœ¬ä»£ç ä»…ç”¨äºå­¦æœ¯ç ”ç©¶ï¼Œå®ç›˜éœ€è°¨æ…

### å»ºè®®
- ä¸¥æ ¼è®¾ç½®æ­¢æŸ
- æ§åˆ¶æœ€å¤§åŠ ä»“æ¬¡æ•°
- å……è¶³çš„èµ„é‡‘å‚¨å¤‡
- é€‰æ‹©é€‚åˆçš„å¸‚åœºç¯å¢ƒï¼ˆéœ‡è¡åå¤šï¼‰

## ğŸ“ˆ å›æµ‹æŒ‡æ ‡

ç¨‹åºä¼šè¾“å‡ºä»¥ä¸‹æŒ‡æ ‡ï¼š
- æ€»æ”¶ç›Šç‡
- å¹´åŒ–æ”¶ç›Šç‡
- å¤æ™®æ¯”ç‡
- æœ€å¤§å›æ’¤
- èƒœç‡
- å¹³å‡ç›ˆäºæ¯”
- äº¤æ˜“æ¬¡æ•°

## ğŸ”§ ä¿®æ”¹ç­–ç•¥å‚æ•°

å¯ä»¥åœ¨ `martingale_strategy.py` ä¸­ä¿®æ”¹ç­–ç•¥ç±»çš„ `params` å‚æ•°ï¼š

```python
class MartingaleStrategy(bt.Strategy):
    params = (
        ('initial_units', 1),          # åˆå§‹æ‰‹æ•°
        ('profit_target_pct', 0.5),    # ç›ˆåˆ©ç›®æ ‡
        ('loss_trigger_pct', -0.3),    # åŠ ä»“è§¦å‘
        ('max_pyramid_levels', 5),     # æœ€å¤§åŠ ä»“æ¬¡æ•°
        ('multiplier', 2.0),           # åŠ ä»“å€æ•°
        ('stop_loss_pct', -10.0),      # æ­¢æŸ
    )
```

## ğŸ“ è¾“å‡ºç¤ºä¾‹

```
============================================================
è¿è¡Œç­–ç•¥: æ ‡å‡†é©¬ä¸æ ¼å°”
============================================================
åŠ è½½æ•°æ®: ../nq_m1_forward_adjusted.csv
æ•°æ®èŒƒå›´: 2024-01-01 ~ 2024-12-31
æ•°æ®è¡Œæ•°: 250000
æ—¶é—´å‘¨æœŸ: d1
============================================================

åˆå§‹èµ„é‡‘: 100000.00

2024-01-02 å¼€å¤šå• ä»·æ ¼: 16500.00, æ‰‹æ•°: 1
2024-01-05 åŠ ä»“ Level 1: ä»·æ ¼: 16450.00, æ–°å¢æ‰‹æ•°: 2, æ€»æ‰‹æ•°: 3
2024-01-10 æ­¢ç›ˆå¹³ä»“ å½“å‰ä»·: 16520.00, ç›ˆåˆ©: 0.52%

æœ€ç»ˆèµ„é‡‘: 105234.56
å‡€åˆ©æ¶¦: 5234.56
æ”¶ç›Šç‡: 5.23%

============================================================
è¯¦ç»†åˆ†æ
============================================================
å¤æ™®æ¯”ç‡: 1.23
æœ€å¤§å›æ’¤: 8.45%
æ€»æ”¶ç›Šç‡: 5.23%
å¹´åŒ–æ”¶ç›Šç‡: 5.50%

äº¤æ˜“ç»Ÿè®¡:
  æ€»äº¤æ˜“æ¬¡æ•°: 45
  ç›ˆåˆ©æ¬¡æ•°: 28
  äºæŸæ¬¡æ•°: 17
  èƒœç‡: 62.22%
  å¹³å‡ç›ˆåˆ©: 234.56
  å¹³å‡äºæŸ: -123.45
============================================================
```

## ğŸ’¡ ç ”ç©¶å»ºè®®

1. **å¯¹æ¯”ä¸åŒæ—¶é—´å‘¨æœŸ**: æµ‹è¯• m15, m30, h1, h4, d1 çš„æ•ˆæœå·®å¼‚
   ```bash
   # çŸ­å‘¨æœŸ
   python run_martingale.py --timeframe m15 --compare --start 2024-01-01 --end 2024-12-31
   
   # ä¸­å‘¨æœŸ
   python run_martingale.py --timeframe h1 --compare --start 2024-01-01 --end 2024-12-31
   
   # é•¿å‘¨æœŸ
   python run_martingale.py --timeframe d1 --compare --start 2024-01-01 --end 2024-12-31
   ```

2. **å‚æ•°ä¼˜åŒ–**: è°ƒæ•´åŠ ä»“å€æ•°ã€è§¦å‘æ¡ä»¶
3. **å¸‚åœºç¯å¢ƒ**: åˆ†åˆ«æµ‹è¯•éœ‡è¡æœŸå’Œè¶‹åŠ¿æœŸ
4. **èµ„é‡‘ç®¡ç†**: æµ‹è¯•ä¸åŒçš„åˆå§‹èµ„é‡‘è§„æ¨¡
5. **æ­¢æŸç­–ç•¥**: å¯¹æ¯”å›ºå®šæ­¢æŸå’Œç§»åŠ¨æ­¢æŸ

**é‡è¦**: é©¬ä¸æ ¼å°”ç­–ç•¥åœ¨çŸ­å‘¨æœŸ(m1-m15)é£é™©æé«˜ï¼Œå»ºè®®ä»è¾ƒé•¿å‘¨æœŸ(h1æˆ–d1)å¼€å§‹æµ‹è¯•ï¼

## ğŸ“ è¯´æ˜

è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç ”ç©¶é¡¹ç›®ï¼Œä¸ä¸»å›æµ‹ç³»ç»Ÿ (`bt_main.py`) åˆ†ç¦»ï¼Œæ–¹ä¾¿å•ç‹¬ç ”ç©¶é©¬ä¸æ ¼å°”ç­–ç•¥çš„ç‰¹æ€§ã€‚
